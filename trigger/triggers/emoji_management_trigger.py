from trigger.trigger import Trigger
from discord import ApplicationContext

class EmojiManagementTrigger(Trigger):
    def __init__(self):
        super().__init__("Emoji Management Vulnerability")
    
    async def check(self, ctx: ApplicationContext, **kwargs):
        await super().check(ctx)

        dmr = kwargs.get('defmemrole')
        
        # TODO: fix not detecting Create Expressions permission vulnerability
        if not dmr.permissions.manage_emojis:
            return f'[✅] Your server is NOT vulnerable by EmMV! But double-check Create Expressions permission for {dmr.mention}!'

        return f'[❌] Your server is vulnerable by EmMV! Possible solution: remove Create/Manage Expressions permission from {dmr.mention} role.'