from trigger.trigger import Trigger
from discord import ApplicationContext, AutoModTriggerType

class MassPingTrigger(Trigger):
    def __init__(self):
        super().__init__("Mass-Ping Vulnerability")
    
    async def check(self, ctx: ApplicationContext, **kwargs):
        await super().check(ctx)

        automod_rules = await ctx.guild.fetch_auto_moderation_rules()
        
        for rule in automod_rules:
            if rule.trigger_type is AutoModTriggerType.mention_spam and rule.trigger_metadata.mention_total_limit <= 10:
                return '[✅] Your server is NOT vulnerable by EMV!'

        return '[❌] Your server is vulnerable by Mass-Ping! Possible solution: add Discord AutoMod Anti-MassPing rule.'