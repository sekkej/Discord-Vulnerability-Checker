from trigger.trigger import Trigger
from discord import ApplicationContext

class EveryoneTrigger(Trigger):
    def __init__(self):
        super().__init__("Everyone Mention Vulnerability")
    
    async def check(self, ctx: ApplicationContext, **kwargs):
        await super().check(ctx)

        dmr = kwargs.get('defmemrole')
        channels = ctx.guild.text_channels
        vulnerable_channels = []

        for channel in channels:
            member_perms = channel.permissions_for(dmr)
            if member_perms.mention_everyone:
                vulnerable_channels.append(channel.mention)
        
        if len(vulnerable_channels) == 0:
            return '[✅] Your server is NOT vulnerable by EvMV!'

        return '[❌] Channels: ' + ', '.join(vulnerable_channels) + ' are vulnerable by EvMV! Possible solution: properly set Mention Everyone permission for those channels.'